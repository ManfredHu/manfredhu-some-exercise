<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h1>https://juejin.cn/post/7030585901524713508</h1>
  <script>
    function sizeofUtf16Bytes(str) {
        var total = 0,
            charCode,
            i,
            len;
        for (i = 0, len = str.length; i < len; i++) {
            charCode = str.charCodeAt(i);
            if (charCode <= 0xffff) {
                total += 2;
            } else {
                total += 4;
            }
        }
        return total;
    }

    // ä½œè€…ï¼šäº‘çš„ä¸–ç•Œ
    // é“¾æŽ¥ï¼šhttps://juejin.cn/post/7030585901524713508
    // æ¥æºï¼šç¨€åœŸæŽ˜é‡‘
    // è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…èŽ·å¾—æŽˆæƒï¼Œéžå•†ä¸šè½¬è½½è¯·æ³¨æ˜Žå‡ºå¤„ã€‚
    const charTxt = "äºº";
    let count = (10 * 1024 * 1024 / 2) - 8 / 2;
    // 10M * 1024k/M * 1024B/k
    let content = new Array(count).fill(charTxt).join(""); // key+valueå·²ç»æ»¡äº†ï¼Œå¦‚æžœè¿™é‡Œå†åŠ 1å°±ä¼šå¤±è´¥ï¼Œå¦‚ä¸‹
    // err DOMException: Failed to execute 'setItem' on 'Storage': Setting the value of 'aaðŸ”´' exceeded the quota.
    const key = "aaðŸ”´"; // aæ˜¯2ä¸ªå­—èŠ‚,16ä½è¡¨ç¤ºä¸º0x0061; ðŸ”´æ˜¯4ä¸ªå­—èŠ‚ï¼Œ32ä½è¡¨ç¤ºä¸º0xd83d 0xdd34ï¼Œè¿™é‡Œå…±8ä¸ªå­—èŠ‚
    localStorage.clear();
    try {
      localStorage.setItem(key, content);
    } catch (err) {
      console.log("err", err);
    }

    const sizeKey = sizeofUtf16Bytes(key);
    const contentSize = sizeofUtf16Bytes(content);
    console.log("key size:", sizeKey, key.length);
    console.log("content size:", contentSize, content.length);
    console.log("total size:", sizeKey + contentSize, content.length + key.length);
  </script>
</body>
</html>
# WS握手与数据解析
html文件表示客户端, 发出 ws握手请求. js文件为服务端, 用于支持握手和解析WS数据帧

## WebSocket数据帧

```
// 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
// +-+-+-+-+-------+-+-------------+-------------------------------+
// |F|R|R|R| opcode|M| Payload len |    Extended payload length    |
// |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
// |N|V|V|V|       |S|             |   (if payload len==126/127)   |
// | |1|2|3|       |K|             |                               |
// +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
// |     Extended payload length continued, if payload len == 127  |
// + - - - - - - - - - - - - - - - +-------------------------------+
// |                               |Masking-key, if MASK set to 1  |
// +-------------------------------+-------------------------------+
// | Masking-key (continued)       |          Payload Data         |
// +-------------------------------- - - - - - - - - - - - - - - - +
// :                     Payload Data continued ...                :
// + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
// |                     Payload Data continued ...                |
// +---------------------------------------------------------------+

// FIN: 结束位标识, 默认0. 如果为1表示数据帧为最后一帧
// RESV1-3: 三个表示都是1bit长(0或1),  必须设置为0，除非扩展了非0值含义的扩展。如果收到了一个非0值但是没有扩展任何非0值的含义，接收终端必须断开WebSocket连接
// Opcode: 4 bit长,用于枚举操作
//   - %x0 表示一个持续帧
//   - %x1 表示一个文本帧
//   - %x2 表示一个二进制帧
//   - %x3-7 预留给以后的非控制帧
//   - %x8 表示一个连接关闭包
//   - %x9 表示一个ping包
//   - %xA 表示一个pong包
//   - %xB-F 预留给以后的控制帧
// Mask: 1 bit, mask标志位，定义payload是否添加掩码。如果设置为1，那么掩码的键值存在于Masking-Key中. 客户端发送服务端时为1, 服务端发送客户端为0
// Payload length: 7 bits, 7+16 bits, or 7+64 bits.
//   - 如果值为0-125，那么就表示负载数据的长度
//   - 如果是126，那么接下来的2个bytes解释为16bit的无符号整形作为负载数据的长度
//   - 如果是127，那么接下来的8个bytes解释为一个64bit的无符号整形（最高位的bit必须为0）作为负载数据的长度
// Masking-Key: 0 or 4 bytes. 对应上面Mask, 客户端发送为1, 是一个32bit长的Key, 用于解密数据
// Payload Data: 传输的数据, 位数为8的倍数代码
```

- 客户端发送服务端: 有mask, 有Mask-key
- 服务端回复客户端: 发送数据帧, 特别注意的是没有 mask, 自然也就没有Mask-key